{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <h2>Superadmin - Admin Management</h2>

  <p>This page is private to superadmins. Use it to add/remove admins and restrict/unrestrict admin accounts.</p>

  <h4 class="mt-3">Current Admins</h4>
  <table class="table">
    <thead>
      <tr><th>ID</th><th>Username</th><th>Full Name</th><th>School</th><th>Restricted</th><th>Actions</th></tr>
    </thead>
    <tbody>
      {% for a in admins %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.username }}</td>
        <td>{{ a.full_name or '—' }}</td>
        <td>{{ (a.school.name if a.school else '—') }}</td>
        <td>{{ 'Yes' if a.is_restricted else 'No' }}</td>
        <td>
          <form method="post" action="{{ url_for('superadmin_toggle_restrict', user_id=a.id) }}" style="display:inline">
            <button class="btn btn-sm btn-{{ 'success' if a.is_restricted else 'warning' }}">{{ 'Unrestrict' if a.is_restricted else 'Restrict' }}</button>
          </form>
          <form method="post" action="{{ url_for('superadmin_delete_admin', user_id=a.id) }}" style="display:inline; margin-left:6px;" onsubmit="return confirm('Delete this admin?');">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
          <form method="post" action="{{ url_for('superadmin_reset_password', user_id=a.id) }}" style="display:inline; margin-left:6px;">
            <button class="btn btn-sm btn-secondary">Reset Password</button>
          </form>
          <form method="post" action="{{ url_for('superadmin_set_admin_school', user_id=a.id) }}" style="display:inline; margin-left:6px;">
            <select name="school_id" class="form-select form-select-sm" style="display:inline-block; width:auto;">
              <option value="">Unassigned</option>
              {% for s in schools %}
                <option value="{{ s.id }}" {% if a.school and a.school.id==s.id %}selected{% endif %}>{{ s.name }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-primary">Set</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h4 class="mt-4">Add Admin</h4>
  <form method="post" action="{{ url_for('superadmin_add_admin') }}">
    <div class="mb-2">
      <label>Username</label>
      <input class="form-control" name="username" required>
    </div>
    <div class="mb-2">
      <label>Full name</label>
      <input class="form-control" name="full_name">
    </div>
    <div class="mb-2">
      <label>Password</label>
      <input class="form-control" name="password" placeholder="leave empty to use username">
    </div>
    <button class="btn btn-primary">Create Admin</button>
  </form>
  <div class="mt-3">
    <a class="btn btn-outline-secondary" href="{{ url_for('superadmin_change_password') }}">Change Your Password</a>
    <a class="btn btn-outline-primary ms-2" href="{{ url_for('admin_schools') }}">Manage Schools</a>
    <a class="btn btn-outline-dark ms-2" href="{{ url_for('superadmin_logout') }}">Logout</a>
  </div>
</div>
{% endblock %}
